import{c as L,j as e,W as w,ap as y,r as o,bB as D,V as F,b as C,T as I,bC as P,U as R,bD as $,a8 as E,ac as S,X as M,D as B}from"./index-DgiJRG6U.js";import{S as f,d as A}from"./Search-DD12e3el.js";import{I as U}from"./InputAdornment-BWU_Cmi9.js";import{C as z,a as K}from"./CardContent-vxvZq6WN.js";import{R as W}from"./quill.snow-BmCvDfXY.js";import{R as H}from"./ripple-button-u1P79abA.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=L("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),J=()=>e.jsxs(w,{className:"p-3 mb-2",children:[e.jsx(f,{variant:"text",height:24,width:"80%"}),e.jsx(f,{variant:"text",height:16,width:"60%"})]}),O=({nameCourse:s,onClick:r,isActive:t})=>e.jsx("div",{onClick:r,className:`flex items-center gap-2 px-3 py-2 text-slate-600 hover:rounded-lg  w-full transition mb-2 cursor-pointer border-b border-slate-400 ${t?"bg-slate-200 rounded-lg":"bg-gray-100 hover:bg-slate-200"}`,children:e.jsx("span",{className:"text-base font-semibold",children:s})}),Q=()=>{const s=y(),[r,t]=o.useState(!1);return{createForum:async n=>{t(!0);try{const p=await s.post("/forums",{courseId:n,title:"New Forum",description:"Description of the new forum"})}catch{}finally{t(!1)}},loading:r}},V=()=>{const{courses:s,loading:r}=D(),{createForum:t,loading:h}=Q(),n=F(),{t:p}=C(),[g,c]=o.useState(null),[a,i]=o.useState(""),m=l=>{c(l),t(l),n(`/forum/${l}`)},x=o.useMemo(()=>a.trim()?s.filter(l=>l.name.toLowerCase().includes(a.toLowerCase())):s,[s,a]);return e.jsxs("div",{className:"h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsx("p",{className:"text-slate-600 font-semibold text-lg ",children:p("Forum")}),e.jsx(I,{fullWidth:!0,placeholder:p("forum.search_course_placeholder"),value:a,onChange:l=>i(l.target.value),variant:"outlined",size:"small",InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx(A,{color:"action"})})}})]}),r?e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:Array.from({length:3}).map((l,j)=>e.jsx(J,{},j))}):e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:x.length>0?x.map(l=>e.jsx(O,{nameCourse:l.name,onClick:()=>m(l.id),isActive:g===l.id},l.id)):e.jsx("p",{className:"text-center text-slate-700 py-4",children:p("forum.no_courses_found")})})]})},Y=()=>{const s=y();o.useState(null);const[r,t]=o.useState(!1),[h,n]=o.useState(null);return{createTopicComment:async({content:c,topicId:a})=>{t(!0),n(null);try{const i=await s.post("/topiccomments",{content:c,topicId:a})}catch(i){console.error("Lỗi khi tạo topic:",i),n(i)}finally{t(!1)}},getTopicComment:async c=>{t(!0),n(null);try{return(await s.get(`/topics/comments/${c}`)).data}catch(a){return console.error("Lỗi khi lấy danh sách topic:",a),n(a),null}finally{t(!1)}}}},T="/learn-x/assets/profile-user-DfsRXmBN.png",q=({user:s,content:r,createAt:t,topicId:h})=>{const n=JSON.parse(localStorage.getItem("user")||"{}"),{createTopicComment:p,getTopicComment:g}=Y(),{t:c}=C(),[a,i]=o.useState(!1),[m,x]=o.useState(""),[l,j]=o.useState([]),[v,N]=o.useState(!1),d=async()=>{const u=await g(h);console.log("🚀 ~ fetchComment ~ data:",u),j(u.data||[])};o.useEffect(()=>{d()},[]);const b=async()=>{m.trim()&&!a&&(i(!0),await p({content:m,topicId:h}),x(""),await d(),i(!1))},_=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),b())};return e.jsxs("div",{className:"w-full p-4 bg-white rounded-lg shadow-lg border border-slate-200",children:[e.jsxs("div",{className:" flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:s.avatarUrl||T,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-sm text-slate-700 truncate",children:s.username}),e.jsx("span",{className:"text-sm text-slate-500",children:k(t)})]})})]}),e.jsx("div",{className:"flex my-2 mx-4",children:e.jsx("p",{className:"text-slate-700 text-sm ",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:r}})})}),e.jsxs("div",{className:"px-4 border-t border-slate-300 mx-2",children:[e.jsx("div",{className:"flex items-center gap-2 text-slate-600 cursor-pointer mt-2",onClick:()=>N(!v),children:e.jsx("span",{className:"text-sm text-slate-500 hover:underline hover:text-slate-600 transition",children:c("topic.comments_count",{count:l.length})})}),v&&e.jsx("div",{className:"px-4 my-2 space-y-2",children:l.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:c("topic.no_comments")}):l.map(u=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:u.account.avatarUrl||T,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 bg-slate-50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-700",children:u.account.email}),e.jsx("div",{className:"text-sm text-slate-500",children:k(u.createdAt)})]}),e.jsx("p",{className:"text-slate-700 text-sm",children:u.content})]})]},u.id))})]}),e.jsxs("div",{className:"px-4 flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:n.avatar,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:m,onChange:u=>x(u.target.value),onKeyDown:_,placeholder:c("topic.comment_input_placeholder"),className:"w-full py-2 px-3 border-b border-slate-300 focus:outline-none text-slate-600 "}),e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 contrast-50 hover:contrast-200 transition",onClick:b,disabled:a,children:a?e.jsx(P,{className:"w-5 h-5 animate-spin text-primaryDark"}):e.jsx(X,{className:"w-5 h-5"})})]})]})]})},k=s=>{const r=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5],Math.floor(s[6]/1e6)),t=h=>String(h).padStart(2,"0");return`${t(r.getHours())}:${t(r.getMinutes())}
     ${t(r.getDate())}/${t(r.getMonth()+1)}/${r.getFullYear()}`},G=()=>{const s=y();o.useState(null);const[r,t]=o.useState(!1),[h,n]=o.useState(null);return{createTopic:async({content:c,forumId:a})=>{t(!0),n(null);try{const i=await s.post("/topics",{content:c,forumId:a})}catch(i){console.error("Lỗi khi tạo topic:",i),n(i)}finally{t(!1)}},getTopics:async c=>{t(!0),n(null);try{return(await s.get(`/forums/forum/${c}/topics`)).data}catch(a){return console.error("Lỗi khi lấy danh sách topic:",a),n(a),null}finally{t(!1)}}}},Z=()=>e.jsx(z,{className:"shadow-sm mb-4",children:e.jsxs(K,{children:[e.jsxs(w,{className:"flex items-center gap-3 mb-3",children:[e.jsx(f,{variant:"circular",width:40,height:40}),e.jsxs(w,{className:"flex-1",children:[e.jsx(f,{variant:"text",height:20,width:"30%"}),e.jsx(f,{variant:"text",height:16,width:"20%"})]})]}),e.jsx(f,{variant:"text",height:24,width:"100%"}),e.jsx(f,{variant:"text",height:24,width:"80%"}),e.jsx(f,{variant:"text",height:24,width:"60%"})]})}),ee={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:600,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},te=()=>{const[s,r]=o.useState(!1),[t,h]=o.useState(""),[n,p]=o.useState([]),[g,c]=o.useState(!1),[a,i]=o.useState(!1),{forumId:m}=R(),{t:x}=C(),{createTopic:l,getTopics:j}=G(),v=async()=>{if(m){c(!0);try{const d=await j(m);p(d.data||[])}catch(d){console.error("Lỗi khi lấy danh sách topics:",d)}finally{c(!1)}}};o.useEffect(()=>{v()},[m]);const N=async()=>{if(!(!t.trim()||!m)){i(!0);try{await l({content:t,forumId:m}),await v(),r(!1),h("")}catch(d){console.error("Lỗi khi tạo topic:",d)}finally{i(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-4 p-4 h-full focus:outline-none",tabIndex:-1,children:[m?e.jsx(H,{onClick:()=>r(!0),children:x("forum.create_topic")}):e.jsx("div",{className:"text-lg text-center text-slate-600 font-semibold pt-6 h-full bg-white rounded-lg shadow-md",children:x("forum.please_select_forum")}),g?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6",children:Array.from({length:3}).map((d,b)=>e.jsx(Z,{},b))}):n.length>0&&m?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6 overflow-y-auto",children:n.map(d=>e.jsx(q,{topicId:d.id,user:d.account,content:d.content,createAt:d.createdAt},d.id))}):m&&e.jsx("div",{className:"text-center mt-6 text-slate-600 font-semibold",children:x("forum.no_topics")}),e.jsx($,{open:s,onClose:()=>r(!1),"aria-labelledby":"modal-title","aria-describedby":"modal-description",children:e.jsxs(w,{sx:ee,children:[e.jsx(E,{id:"modal-title",variant:"h6",component:"h2",sx:{mb:2},children:x("forum.new_topic_title")}),e.jsx(W,{theme:"snow",value:t,onChange:h,style:{height:200,marginBottom:52},placeholder:x("forum.new_topic_placeholder")}),e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(S,{variant:"outlined",color:"secondary",onClick:()=>r(!1),sx:{borderRadius:2},disabled:a,children:x("forum.cancel")}),e.jsx(S,{variant:"contained",color:"primary",onClick:N,sx:{borderRadius:2},disabled:a,children:a?e.jsx(M,{size:20,color:"inherit"}):x("forum.submit")})]})]})})]})},se=()=>e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:" w-1/4 h-full bg-white p-4 m-4 rounded-lg",children:e.jsx(V,{})}),e.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:e.jsx(te,{})})]}),ie=()=>e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-170px)] ",children:[e.jsx(B,{title:"Forum"}),e.jsx("div",{className:"flex-grow h-0 overflow-hidden bg-slate-200",children:e.jsx(se,{})})]});export{ie as default};
