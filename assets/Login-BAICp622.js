import{r as u,P as A,j as t,w as W,u as Y,af as _,aq as J,ar as D,J as P,D as Q}from"./index-D0u0md9i.js";import{c as z,a as Z}from"./react-spring_web.modern-B8T182cm.js";import{u as H,c as F,E as U,a as V}from"./index-DZMYYOmy.js";var O=new Map,I=new WeakMap,B=0,ee=void 0;function te(e){return e?(I.has(e)||(B+=1,I.set(e,B.toString())),I.get(e)):"0"}function se(e){return Object.keys(e).sort().filter(s=>e[s]!==void 0).map(s=>`${s}_${s==="root"?te(e.root):e[s]}`).toString()}function re(e){const s=se(e);let r=O.get(s);if(!r){const l=new Map;let n;const a=new IntersectionObserver(c=>{c.forEach(i=>{var f;const p=i.isIntersecting&&n.some(g=>i.intersectionRatio>=g);e.trackVisibility&&typeof i.isVisible>"u"&&(i.isVisible=p),(f=l.get(i.target))==null||f.forEach(g=>{g(p,i)})})},e);n=a.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:s,observer:a,elements:l},O.set(s,r)}return r}function ne(e,s,r={},l=ee){if(typeof window.IntersectionObserver>"u"&&l!==void 0){const f=e.getBoundingClientRect();return s(l,{isIntersecting:l,target:e,intersectionRatio:typeof r.threshold=="number"?r.threshold:0,time:0,boundingClientRect:f,intersectionRect:f,rootBounds:f}),()=>{}}const{id:n,observer:a,elements:c}=re(r),i=c.get(e)||[];return c.has(e)||c.set(e,i),i.push(s),a.observe(e),function(){i.splice(i.indexOf(s),1),i.length===0&&(c.delete(e),a.unobserve(e)),c.size===0&&(a.disconnect(),O.delete(n))}}function ae({threshold:e,delay:s,trackVisibility:r,rootMargin:l,root:n,triggerOnce:a,skip:c,initialInView:i,fallbackInView:f,onChange:p}={}){var g;const[x,N]=u.useState(null),E=u.useRef(),[y,S]=u.useState({inView:!!i,entry:void 0});E.current=p,u.useEffect(()=>{if(c||!x)return;let v;return v=ne(x,(R,L)=>{S({inView:R,entry:L}),E.current&&E.current(R,L),L.isIntersecting&&a&&v&&(v(),v=void 0)},{root:n,rootMargin:l,threshold:e,trackVisibility:r,delay:s},f),()=>{v&&v()}},[Array.isArray(e)?e.toString():e,x,n,l,a,c,r,f,s]);const d=(g=y.entry)==null?void 0:g.target,C=u.useRef();!x&&d&&!a&&!c&&C.current!==d&&(C.current=d,S({inView:!!i,entry:void 0}));const m=[N,y.inView,y.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}const G=({children:e,index:s=1,className:r,type:l="fade",...n})=>{const[a,c]=ae({threshold:0,triggerOnce:!0}),i={config:{duration:n.duration?n.duration:300},delay:n.delay?n.delay:100*s},f=z({from:{opacity:0},to:{opacity:c?1:0},...i,...n}),p=z({from:{transform:"translateX(50px)",opacity:0},to:{transform:"translateX(0)",opacity:1},...i,...n}),g=z({from:{opacity:0,transform:"translateY(40px)"},to:{opacity:1,transform:"translateY(0px)"},...i,...n}),x=z({from:{opacity:0,transform:"scale(0.5)"},to:{opacity:1,transform:"scale(1)"},...i,...n}),N={fade:f,slideLeft:p,slideUp:g,zoom:x};return t.jsx(Z.div,{className:r||"",id:n.id,style:N[l],ref:a,children:e})};G.propTypes={index:A.number,className:A.string,type:A.oneOf(["fade","slideUp","slideLeft","zoom"]),children:A.node.isRequired};function ie(e){for(var s=[],r=1;r<arguments.length;r++)s[r-1]=arguments[r];e&&e.addEventListener&&e.addEventListener.apply(e,s)}function oe(e){for(var s=[],r=1;r<arguments.length;r++)s[r-1]=arguments[r];e&&e.removeEventListener&&e.removeEventListener.apply(e,s)}var q=typeof window<"u",le=function(e){u.useEffect(e,[])},ce=function(e){var s=u.useRef(e);s.current=e,le(function(){return function(){return s.current()}})},de=function(e){var s=u.useRef(0),r=u.useState(e),l=r[0],n=r[1],a=u.useCallback(function(c){cancelAnimationFrame(s.current),s.current=requestAnimationFrame(function(){n(c)})},[]);return ce(function(){cancelAnimationFrame(s.current)}),[l,a]},ue=function(e,s){e===void 0&&(e=1/0),s===void 0&&(s=1/0);var r=de({width:q?window.innerWidth:e,height:q?window.innerHeight:s}),l=r[0],n=r[1];return u.useEffect(function(){if(q){var a=function(){n({width:window.innerWidth,height:window.innerHeight})};return ie(window,"resize",a),function(){oe(window,"resize",a)}}},[]),l};const K=({type:e="login"})=>{const{width:s}=ue(),r=W(),[l,n]=u.useState(!1),[a,c]=u.useState(e),[i,f]=u.useState(!1),[p,g]=u.useState(!1),{setAuthUser:x,setIsAuthenticated:N}=Y(),E={email:"",password:"",fullName:"",confirmPassword:""},{register:y,handleSubmit:S,formState:{errors:d},watch:C}=H({mode:"onSubmit",defaultValues:E}),m=o=>{o.key==="Enter"&&(a==="login"?S(v)():S(R)())},v=async({email:o,password:k})=>{var j,h;n(!0);try{const w=await D.login(o,k);if(w.code===200){const{email:b,fullName:M,avatar:T,role:X}=w.data;x({email:b,fullName:M,avatar:T,role:X}),N(!0),r("/")}else P.success(((h=(j=w.response)==null?void 0:j.data)==null?void 0:h.message)||"Đăng nhập thất bại",{type:"error"})}catch{}finally{n(!1)}},R=async({email:o,password:k,fullName:j})=>{var h,w;n(!0);try{const b=await D.register(j,o,k);b.status===200&&(P(b.message||"Đăng ký thành công",{type:"success"}),r(`/register/verify?email=${o}`))}catch(b){P(((w=(h=b.response)==null?void 0:h.data)==null?void 0:w.message)||"Đăng ký thất bại",{type:"error"})}finally{n(!1)}},L=async o=>{var k,j;n(!0);try{const h=await D.loginGoogle(o);if(h.code===200){const{email:w,fullName:b,avatar:M,role:T}=h.data;x({email:w,fullName:b,avatar:M,role:T}),N(!0),r("/")}else P(((j=(k=h.response)==null?void 0:k.data)==null?void 0:j.message)||"Google login thất bại",{type:"error"})}catch(h){P(h.response||"Lỗi đăng nhập Google",{type:"error"})}finally{n(!1)}},$=o=>{o.preventDefault(),r("/identify")};return t.jsx("div",{className:"flex w-full h-screen",children:t.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 4xl:grid-cols-[minmax(0,_1030px)_minmax(0,_1fr)]",children:[s>=1024&&t.jsxs("div",{className:"lg:flex relative hidden justify-center items-center h-full",children:[t.jsx("div",{className:"w-80 h-80 bg-gradient-to-tr from-emerald-600 to-slate-300 rounded-full animate-bounce"}),t.jsx("div",{className:"w-full absolute bottom-0 h-1/2 bg-white/10 backdrop-blur-lg"})]}),t.jsx("div",{className:"bg-widget flex items-center justify-center w-full rounded-3xl py-10 px-4 lg:p-[60px]",children:t.jsxs(G,{className:"max-w-[540px] w-full bg-white px-10 py-20  border-2 border-gray-red shadow-lg",type:"slideUp",duration:400,delay:300,children:[t.jsx("div",{className:"flex flex-col gap-2.5 text-center",children:t.jsx("h1",{children:a==="login"?"Đăng nhập":"Đăng ký"})}),t.jsxs("form",{className:"mt-5",onSubmit:S(a==="login"?v:R),children:[t.jsx(_,{isLoading:l}),t.jsxs("div",{className:"flex flex-col gap-5 rounded-3xl",children:[a==="register"&&t.jsxs("div",{className:"field-wrapper",children:[t.jsx("label",{htmlFor:"fullName",className:"field-label",children:"Tên đầy đủ"}),t.jsx("input",{className:F("field-input"),id:"fullName",type:"text",...y("fullName",{required:"Tên đầy đủ là bắt buộc!"}),onKeyDown:m,placeholder:"Nhập tên của bạn"}),d.fullName&&t.jsx("p",{className:"text-sm text-rose-500",children:d.fullName.message})]}),t.jsxs("div",{className:"field-wrapper",children:[t.jsx("label",{htmlFor:"email",className:"field-label",children:"E-mail"}),t.jsx("input",{className:F("field-input",{"field-input--error":d.email}),id:"email",type:"email",...y("email",{required:"Email là bắt buộc!",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Email không hợp lệ!"}}),onKeyDown:m,placeholder:"Nhập địa chỉ email"}),d.email&&t.jsx("p",{className:"text-sm text-rose-500",children:d.email.message})]}),t.jsxs("div",{className:"field-wrapper relative",children:[t.jsx("label",{htmlFor:"password",className:"field-label",children:"Mật khẩu"}),t.jsx("input",{className:F("field-input",{"field-input--error":d.password}),id:"password",type:p?"text":"password",...y("password",{required:"Mật khẩu là bắt buộc!",minLength:{value:6,message:"Mật khẩu phải có ít nhất 6 kí tự!"},validate:{hasUpperCase:o=>/[A-Z]/.test(o)||"Mật khẩu phải có ít nhất 1 kí tự in hoa!",hasSpecialChar:o=>/[!@#$%^&*(),.?":{}|<>]/.test(o)||"Mật khẩu phải có kí tự đặc biệt!"}}),onKeyDown:m,placeholder:"Nhập mật khẩu"}),t.jsx("button",{type:"button",className:"absolute right-3 top-[38px] text-gray-500",onClick:()=>g(!p),children:p?t.jsx(U,{size:20}):t.jsx(V,{size:20})}),d.password&&t.jsx("p",{className:"text-sm text-rose-500",children:d.password.message})]}),a==="register"&&t.jsxs("div",{className:"field-wrapper relative",children:[t.jsx("label",{htmlFor:"confirmPassword",className:"field-label",children:"Xác nhận mật khẩu"}),t.jsx("input",{className:F("field-input",{"field-input--error":d.confirmPassword}),id:"confirmPassword",type:i?"text":"password",...y("confirmPassword",{required:"Bạn cần xác nhận mật khẩu!",validate:o=>o===C("password")||"Mật khẩu không khớp"}),onKeyDown:m,placeholder:"Nhập lại mật khẩu"}),t.jsx("button",{type:"button",className:"absolute right-3 top-[38px] text-gray-500",onClick:()=>f(!i),children:i?t.jsx(U,{size:20}):t.jsx(V,{size:20})}),d.confirmPassword&&t.jsx("p",{className:"text-sm text-rose-500",children:d.confirmPassword.message})]})]}),a==="login"&&t.jsx("div",{className:"flex justify-center mt-4 mb-6",children:t.jsx("button",{className:"text-btn",onClick:$,type:"button",children:"Quên mật khẩu?"})}),t.jsx("input",{type:"submit",className:"btn btn--primary w-full hover:scale-[1.01] ease-in-out active:scale-[.98] active:duration-75 translate-all mt-6",value:a==="login"?"Đăng nhập":"Đăng ký"})]}),t.jsxs("div",{className:"relative my-4 flex items-center justify-center",children:[t.jsx("span",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-full h-[1px] bg-border"}),t.jsx("span",{className:"relative z-10 bg-widget px-2 text-sm",children:"hoặc"})]}),t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("div",{className:"btn btn--social btn--login border-2",children:t.jsx(J,{theme:"filled_black",onSuccess:o=>L(o.credential),onError:o=>console.log(o)})})}),t.jsxs("div",{className:"flex justify-center gap-2.5 ",children:[t.jsx("p",{children:a==="login"?"Chưa có tài khoản?":"Đã có tài khoản?"}),t.jsx("button",{className:"text-btn",onClick:()=>c(a==="login"?"register":"login"),children:a==="login"?"Đăng ký":"Đăng nhập"})]})]})})]})})};K.propTypes={type:A.string};const pe=()=>t.jsxs(t.Fragment,{children:[t.jsx(Q,{title:"Đăng nhập"}),t.jsx(K,{type:"login"})]});export{pe as default};
