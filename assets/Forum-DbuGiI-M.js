import{j as e,x as w,cu as k,w as L,c as N,r as o,T as I,I as D,ad as F,v as R,ae as M,Y as E,a2 as C,y as P,D as A}from"./index-CjWvOQUe.js";import{S as y}from"./Skeleton-DA1YD-A5.js";import{a as B,u as K,p as S,S as U,b as z,M as H,T as W}from"./useForum-B0CjKC75.js";import{d as $}from"./Search-CoX4_sYE.js";import{R as J}from"./index-Cdx-CGry.js";import{R as O}from"./ripple-button-tScH28id.js";const Q=()=>e.jsxs(w,{className:"p-3 mb-2",children:[e.jsx(y,{variant:"text",height:24,width:"80%"}),e.jsx(y,{variant:"text",height:16,width:"60%"})]}),V=({nameCourse:t,onClick:i,isActive:d})=>e.jsx("div",{onClick:i,className:`flex items-center gap-2 px-3 py-2 text-slate-600 hover:rounded-lg  w-full transition mb-2 cursor-pointer border-b border-slate-400 ${d?"bg-slate-200 rounded-lg":"bg-gray-100 hover:bg-slate-200"}`,children:e.jsx("span",{className:"text-base font-semibold",children:t})}),Y=()=>{const{courses:t,loading:i}=k(),{createForum:d,loading:h}=B(),f=L(),{t:x}=N(),[p,m]=o.useState(null),[c,u]=o.useState(""),l=s=>{m(s),d(s),f(`/forum/${s}`)},r=o.useMemo(()=>c.trim()?t.filter(s=>s.name.toLowerCase().includes(c.toLowerCase())):t,[t,c]);return e.jsxs("div",{className:"h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsx("p",{className:"text-slate-600 font-semibold text-lg ",children:x("Forum")}),e.jsx(I,{fullWidth:!0,placeholder:x("forum.search_course_placeholder"),value:c,onChange:s=>u(s.target.value),variant:"outlined",size:"small",InputProps:{startAdornment:e.jsx(D,{position:"start",children:e.jsx($,{color:"action"})})}})]}),i?e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:Array.from({length:3}).map((s,j)=>e.jsx(Q,{},j))}):e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:r.length>0?r.map(s=>e.jsx(V,{nameCourse:s.name,onClick:()=>l(s.id),isActive:p===s.id},s.id)):e.jsx("p",{className:"text-center text-slate-700 py-4",children:x("forum.no_courses_found")})})]})},Z=({user:t,content:i,createAt:d,topicId:h})=>{const f=JSON.parse(localStorage.getItem("user")||"{}"),{createTopicComment:x,getTopicComment:p}=K(),{t:m}=N(),[c,u]=o.useState(!1),[l,r]=o.useState(""),[s,j]=o.useState([]),[g,b]=o.useState(!1),a=async()=>{const n=await p(h);j(n.data||[])};o.useEffect(()=>{a()},[]);const v=async()=>{l.trim()&&!c&&(u(!0),await x({content:l,topicId:h}),r(""),await a(),u(!1))},_=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),v())};return e.jsxs("div",{className:"w-full p-4 bg-white rounded-lg shadow-lg border border-slate-200",children:[e.jsxs("div",{className:" flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:t.avatarUrl||S,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-sm text-slate-700 truncate",children:t.username}),e.jsx("span",{className:"text-sm text-slate-500",children:T(d)})]})})]}),e.jsx("div",{className:"flex my-2 mx-4",children:e.jsx("p",{className:"text-slate-700 text-sm ",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:i}})})}),e.jsxs("div",{className:"px-4 border-t border-slate-300 mx-2",children:[e.jsx("div",{className:"flex items-center gap-2 text-slate-600 cursor-pointer mt-2",onClick:()=>b(!g),children:e.jsx("span",{className:"text-sm text-slate-500 hover:underline hover:text-slate-600 transition",children:m("topic.comments_count",{count:s.length})})}),g&&e.jsx("div",{className:"px-4 my-2 space-y-2",children:s.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:m("topic.no_comments")}):s.map(n=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:n.account.avatarUrl||S,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 bg-slate-50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-700",children:n.account.email}),e.jsx("div",{className:"text-sm text-slate-500",children:T(n.createdAt)})]}),e.jsx("p",{className:"text-slate-700 text-sm",children:n.content})]})]},n.id))})]}),e.jsxs("div",{className:"px-4 flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:f.avatar,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:l,onChange:n=>r(n.target.value),onKeyDown:_,placeholder:m("topic.comment_input_placeholder"),className:"w-full py-2 px-3 border-b border-slate-300 focus:outline-none text-slate-600 "}),e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 contrast-50 hover:contrast-200 transition",onClick:v,disabled:c,children:c?e.jsx(F,{className:"w-5 h-5 animate-spin text-primaryDark"}):e.jsx(U,{className:"w-5 h-5"})})]})]})]})},T=t=>new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5],Math.floor(t[6]/1e6)).toLocaleString("vi-VN",{timeZone:"Asia/Ho_Chi_Minh",hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}),q={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:600,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},G=()=>{const[t,i]=o.useState(!1),[d,h]=o.useState(""),[f,x]=o.useState([]),[p,m]=o.useState(!1),[c,u]=o.useState(!1),{forumId:l}=R(),{t:r}=N(),{createTopic:s,getTopics:j}=z(),g=async()=>{if(l){m(!0);try{const a=await j(l);x(a.data||[])}catch(a){console.error("Lỗi khi lấy danh sách topics:",a)}finally{m(!1)}}};o.useEffect(()=>{g()},[l]);const b=async()=>{if(!(!d.trim()||!l)){u(!0);try{await s({content:d,forumId:l}),await g(),i(!1),h("")}catch(a){console.error("Lỗi khi tạo topic:",a)}finally{u(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-4 p-4 h-full focus:outline-none",tabIndex:-1,children:[l?e.jsx("div",{children:e.jsx(O,{className:"min-w-full",onClick:()=>i(!0),children:r("forum.create_topic")})}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-lg text-center text-slate-500 font-semibold pt-6 h-full bg-white rounded-lg shadow-md",children:[e.jsx(H,{className:" w-16 h-16 mb-2 animate-bounce"}),r("forum.please_select_forum")]}),p?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6",children:Array.from({length:3}).map((a,v)=>e.jsx(W,{},v))}):f.length>0&&l?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6 overflow-y-auto ",children:f.map(a=>e.jsx(Z,{topicId:a.id,user:a.account,content:a.content,createAt:a.createdAt},a.id))}):l&&e.jsx("div",{className:"text-center mt-6 text-slate-600 font-semibold",children:r("forum.no_topics")}),e.jsx(M,{open:t,onClose:()=>i(!1),"aria-labelledby":"modal-title","aria-describedby":"modal-description",children:e.jsxs(w,{sx:q,children:[e.jsx(E,{id:"modal-title",variant:"h6",component:"h2",sx:{mb:2},children:r("forum.new_topic_title")}),e.jsx(J,{theme:"snow",value:d,onChange:h,style:{height:200,marginBottom:52},placeholder:r("forum.new_topic_placeholder")}),e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(C,{variant:"outlined",color:"secondary",onClick:()=>i(!1),sx:{borderRadius:2},disabled:c,children:r("forum.cancel")}),e.jsx(C,{variant:"contained",color:"primary",onClick:b,sx:{borderRadius:2},disabled:c,children:c?e.jsx(P,{size:20,color:"inherit"}):r("forum.submit")})]})]})})]})},X=()=>e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:" w-1/4 h-full bg-white p-4 m-4 rounded-lg",children:e.jsx(Y,{})}),e.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:e.jsx(G,{})})]}),re=()=>e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-170px)] ",children:[e.jsx(A,{title:"Forum"}),e.jsx("div",{className:"flex-grow h-0 overflow-hidden bg-slate-200",children:e.jsx(X,{})})]});export{re as default};
