import{e as S,cl as $,cm as O,cn as A,co as se,aw as B,r as x,v as w,cp as ae,aa as ne,j as e,D as Z,x as re,y as F,L as z,h as L,$ as le,a0 as ie,a1 as ce,Y as oe,ab as H,aG as R,aF as de,T as W,ac as me,J as v,af as ue,H as Y}from"./index-D0u0md9i.js";import{M as he}from"./MenuItem-B0AEuM3_.js";import{C as xe}from"./chevron-right-PSVaxeJ8.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=S("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=S("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=S("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function pe(a,t){const n=()=>se(t==null?void 0:t.in,NaN),r=ve(a);let c;if(r.date){const l=ye(r.date,2);c=we(l.restDateString,l.year)}if(!c||isNaN(+c))return n();const u=+c;let o=0,m;if(r.time&&(o=Ce(r.time),isNaN(o)))return n();if(r.timezone){if(m=De(r.timezone),isNaN(m))return n()}else{const l=new Date(u+o),g=$(0,t==null?void 0:t.in);return g.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),g.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),g}return $(u+o+m,t==null?void 0:t.in)}const y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ne=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,je=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,be=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ve(a){const t={},n=a.split(y.dateTimeDelimiter);let s;if(n.length>2)return t;if(/:/.test(n[0])?s=n[0]:(t.date=n[0],s=n[1],y.timeZoneDelimiter.test(t.date)&&(t.date=a.split(y.timeZoneDelimiter)[0],s=a.substr(t.date.length,a.length))),s){const r=y.timezone.exec(s);r?(t.time=s.replace(r[1],""),t.timezone=r[1]):t.time=s}return t}function ye(a,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=a.match(n);if(!s)return{year:NaN,restDateString:""};const r=s[1]?parseInt(s[1]):null,c=s[2]?parseInt(s[2]):null;return{year:c===null?r:c*100,restDateString:a.slice((s[1]||s[2]).length)}}function we(a,t){if(t===null)return new Date(NaN);const n=a.match(Ne);if(!n)return new Date(NaN);const s=!!n[4],r=b(n[1]),c=b(n[2])-1,u=b(n[3]),o=b(n[4]),m=b(n[5])-1;if(s)return Me(t,o,m)?Se(t,o,m):new Date(NaN);{const l=new Date(0);return!Ie(t,c,u)||!ke(t,r)?new Date(NaN):(l.setUTCFullYear(t,c,Math.max(r,u)),l)}}function b(a){return a?parseInt(a):1}function Ce(a){const t=a.match(je);if(!t)return NaN;const n=D(t[1]),s=D(t[2]),r=D(t[3]);return Ee(n,s,r)?n*O+s*A+r*1e3:NaN}function D(a){return a&&parseFloat(a.replace(",","."))||0}function De(a){if(a==="Z")return 0;const t=a.match(be);if(!t)return 0;const n=t[1]==="+"?-1:1,s=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return Ue(s,r)?n*(s*O+r*A):NaN}function Se(a,t,n){const s=new Date(0);s.setUTCFullYear(a,0,4);const r=s.getUTCDay()||7,c=(t-1)*7+n+1-r;return s.setUTCDate(s.getUTCDate()+c),s}const Te=[31,null,31,30,31,30,31,31,30,31,30,31];function G(a){return a%400===0||a%4===0&&a%100!==0}function Ie(a,t,n){return t>=0&&t<=11&&n>=1&&n<=(Te[t]||(G(a)?29:28))}function ke(a,t){return t>=1&&t<=(G(a)?366:365)}function Me(a,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function Ee(a,t,n){return a===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&a>=0&&a<25}function Ue(a,t){return t>=0&&t<=59}const $e=a=>{const t=B(),[n,s]=x.useState(null),[r,c]=x.useState(!0),[u,o]=x.useState(null);return x.useEffect(()=>{if(!a)return;(async()=>{try{const l=await t.get(`/assignment-submissions/assignment/${a}`);s(l.data.data)}catch(l){console.error("Error fetching assignment:",l),o(l)}finally{c(!1)}})()},[a]),{assignment:n,loading:r,error:u}},Fe=async(a,t,n,s)=>{try{return{data:(await a.post(`/assignment-submissions/${t}/${n}/score`,{score:s})).data,error:null}}catch(r){return console.error("Error posting grading:",r),{data:null,error:r}}};function ze({title:a,startDate:t,endDate:n}){const[s,r]=x.useState(null),[c,u]=x.useState(0),{assignmentId:o}=w(),[m,l]=x.useState(""),[g,T]=x.useState(""),[I,k]=x.useState(!1),{courseId:_}=w(),{course:f}=ae(_),{assignment:d,loading:J}=$e(o),K=B(),V=i=>{const h=new Date(n),C=pe(i),j=h-C,p=Math.abs(j),N=Math.floor(p/(1e3*60*60*24)),M=Math.floor(p%(1e3*60*60*24)/(1e3*60*60)),E=Math.floor(p%(1e3*60*60)/(1e3*60)),U=Math.floor(p%(1e3*60)/1e3);return C<h?e.jsxs("div",{className:"py-1 text-blue-500",children:["Nộp sớm ",N>0?`${N} ngày `:"",M," giờ ",E," phút ",U," giây"]}):e.jsxs("div",{className:"py-1 text-rose-600",children:["Nộp trễ ",N>0?`${N} ngày `:"",M," giờ ",E," phút ",U," giây"]})},q=ne(new Date(n),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:me});x.useEffect(()=>{if(d&&d.length>0){const i=d[c];r(i),l(i.score??"")}},[c,d]);const Q=async()=>{if(!(!s||!o)){if(m===""||m<0||m>10){v.error("Vui lòng nhập điểm hợp lệ (0-10)");return}k(!0);try{if((await Fe(K,o,s.studentId,parseFloat(m),g)).error)v.error("Có lỗi xảy ra khi chấm điểm");else{const h={...s,score:parseFloat(m)};r(h),v.success("Chấm điểm thành công!")}}catch{v.error("Có lỗi xảy ra khi chấm điểm")}finally{k(!1)}}},X=i=>{const h=new Date,j=new Date(i)-h;if(j<=0)return"Đã hết hạn";const p=Math.floor(j/(1e3*60*60*24)),N=Math.floor(j%(1e3*60*60*24)/(1e3*60*60));return`Còn lại ${p} ngày ${N} giờ`},ee=()=>{u(i=>i===d.length-1?0:i+1)},te=()=>{u(i=>i===0?d.length-1:i-1)};return e.jsxs("div",{className:"m-4 p-4 flex-1 rounded-lg bg-white h-full",children:[e.jsx(Z,{title:"Chấm điểm bài nộp"}),J?e.jsx(re,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(F,{})}):(d==null?void 0:d.length)===0?e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"}):e.jsxs("div",{className:"h-full",children:[s&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white",children:"Khoá học:"}),f&&e.jsxs(e.Fragment,{children:[e.jsx(z,{to:`/course-detail/${f==null?void 0:f.id}`,className:"text-white hover:underline",children:(f==null?void 0:f.name)||"Đang tải..."}),e.jsx("span",{children:"/"}),e.jsx(z,{to:`/submission/${f==null?void 0:f.id}/${o}`,className:"text-white hover:underline",children:a})]})]})})}),e.jsx("div",{className:"text-xl font-bold text-slate-700",children:"Chấm điểm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:"small",onClick:te,children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsxs(le,{size:"small",variant:"outlined",children:[e.jsx(ie,{id:"student-select-label",children:"Email"}),e.jsx(ce,{labelId:"student-select-label",label:"Email",value:s.studentEmail,onChange:i=>u(d==null?void 0:d.findIndex(h=>h.studentEmail===i.target.value)),sx:{minWidth:180},children:d==null?void 0:d.map((i,h)=>e.jsx(he,{value:i.studentEmail,children:i.studentEmail},h))})]}),e.jsx(L,{size:"small",onClick:ee,children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsxs(oe,{variant:"body2",color:"text.secondary",children:[c+1," of ",d==null?void 0:d.length]})]})]}),s?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-8 h-8 text-slate-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:s.studentName}),e.jsx("div",{className:"text-sm text-slate-600",children:s.studentEmail})]})]}),s.score!==null?e.jsx(H,{label:`Điểm: ${s.score}/10`,color:"success",variant:"filled",sx:{fontSize:"1rem",fontWeight:"bold",px:2,py:1,bgcolor:"#10b981",color:"white"}}):e.jsx(H,{label:"Chưa chấm điểm",color:"error",variant:"filled",sx:{fontSize:"1rem",fontWeight:"bold",px:2,py:1,bgcolor:"#ef4444",color:"white"}})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:"Hạn chót:"}),e.jsx("span",{className:"text-slate-600",children:q})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:"Trạng thái:"}),e.jsx("span",{className:"text-slate-600",children:X(n)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(R,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:"Thời gian nộp:"}),V(s.createdAt)]})]})]}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:"Bài nộp"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"File đã nộp:"}),s!=null&&s.fileSubmissionUrl?e.jsx("a",{href:`http://docs.google.com/gview?url=${s.fileSubmissionUrl}&embedded=true`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:decodeURIComponent(s.fileSubmissionUrl.split("/").pop())}):e.jsx("span",{className:"text-slate-400",children:"Chưa nộp"})]})}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg text-sm",children:[e.jsx("h4",{className:"font-medium text-slate-700 mb-2 text-sm",children:"Nội dung văn bản:"}),s.textSubmission?e.jsx("div",{className:"whitespace-pre-wrap break-words",dangerouslySetInnerHTML:{__html:s.textSubmission}}):e.jsx("span",{className:"text-slate-400",children:"Chưa nộp"})]})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:["Nhận xét",e.jsx(P,{className:"w-4 h-4 text-slate-400"})]}),e.jsx(W,{multiline:!0,placeholder:"Nhập nhận xét cho học sinh...",minRows:4,fullWidth:!0,variant:"outlined",value:g,onChange:i=>T(i.target.value),sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f8fafc"}}})]})}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:["Chấm điểm",e.jsx(P,{className:"w-4 h-4 text-slate-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"grade",className:"block text-sm font-medium text-slate-700 mb-2",children:"Thang điểm 10"}),e.jsx(W,{type:"number",id:"grade",inputProps:{max:10,min:0,step:.1},value:m,fullWidth:!0,size:"medium",placeholder:"Nhập điểm (0-10)",onChange:i=>{const h=i.target.value;(h===""||Number(h)>=0&&Number(h)<=10)&&l(h)},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"#f8fafc"}}})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{l(s.score??""),T(s.feedback??"")},className:"flex-1 py-2 px-3 bg-slate-300 text-white rounded-lg hover:bg-slate-400 transition-colors font-medium",children:"Hủy"}),e.jsxs("button",{onClick:Q,className:`flex-1 py-2 px-3  bg-gradient-to-br from-[#5BCEC9] to-[#14919B]\r
                                                           shadow-md hover:shadow-lg text-white rounded-lg hover:bg-secondary transition-colors font-medium flex items-center justify-center gap-2`,disabled:I||m==="",children:[I&&e.jsx(F,{size:20,color:"inherit"}),"Chấm điểm"]})]})]})]})})]})]}):e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"})]})]})}const We=()=>{const{courseId:a}=w(),{assignmentId:t}=w(),[n,s]=x.useState(null),[r,c]=x.useState(null),[u,o]=x.useState(!1);return x.useEffect(()=>{(async()=>{o(!0);try{const l=await Y.get(`courses/${a}`);l.status===200&&c(l.data.data)}catch(l){console.log(l)}finally{o(!1)}})()},[a]),x.useEffect(()=>{(async()=>{o(!0);try{const l=await Y.get(`/assignments/${t}`,{headers:{"Content-Type":"application/json"}});s(l.data.data)}catch(l){console.log(l)}finally{o(!1)}})()},[t]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Nộp bài"}),e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-170px)]",children:[u&&e.jsx(ue,{isLoading:u}),!u&&n&&e.jsx(ze,{title:n.title,startDate:n.startDate,endDate:n.endDate})]})]})};export{We as default};
