import{at as F,w as L,r,ar as v,J as l,j as s,af as X,D as B,au as V}from"./index-CjWvOQUe.js";function $(){var b;const w=F(),N=L(),x=new URLSearchParams(w.search),i=(b=x.get("email"))==null?void 0:b.replace(/\s/g,"+"),m=x.get("otp"),[c,u]=r.useState(new Array(6).fill("")),o=r.useRef([]),O=r.useRef(null),[P,f]=r.useState(!1);r.useEffect(()=>{if(m&&i){const t=m.split("");u(t),t.forEach((e,n)=>{o.current[n].value=e}),o.current[5].focus(),c.every(e=>e!=="")&&g()}},[m,i]);const R=(t,e)=>{const n=[...c];n[e]=t.value,u(n),t.value&&e<5&&o.current[e+1].focus(),c.every(a=>a!=="")&&g()},D=(t,e)=>{t.key==="Backspace"&&!c[e]&&e>0&&o.current[e-1].focus()},[A,S]=r.useState(5),[C,p]=r.useState(60),[h,y]=r.useState(!1);r.useEffect(()=>{if(h){const t=setInterval(()=>{p(e=>e===1?(clearInterval(t),y(!1),60):e-1)},1e3)}},[h]);const g=async t=>{t&&t.preventDefault();const e=c.join(""),n=i;f(!0);try{const a=await v.verifyEmail(e,n);if(console.log(a),a&&a.status===200){const E=l("Xác thực thành công! Chuyển hướng về trang đăng nhập sau 5s",{duration:5e3,hideProgressBar:!0}),T=setInterval(()=>{S(d=>(d===1?(clearInterval(T),N("/login")):l.update(E,{render:`Xác thực thành công! Chuyển hướng về trang đăng nhập sau ${d-1}s`,autoClose:(d-1)*1e3,hideProgressBar:!0}),d-1))},1e3)}else l.error("Xác thực thất bại. Vui lòng thử lại!",{duration:5e3}),u(Array(c.length).fill("")),o.current[0].focus()}catch(a){console.log(a),l.error("Có lỗi xảy ra, vui lòng thử lại sau!",{duration:5e3})}finally{f(!1)}},I=t=>{const e=t.clipboardData.getData("text");if(e.length===6&&/^\d+$/.test(e)){const n=e.split("");u(n),n.forEach((a,j)=>{o.current[j].value=a}),o.current[5].focus()}t.preventDefault()},k=async()=>{f(!0);try{const t=await v.resendOtp(i);t&&t.status===200?(l.success("Mã OTP đã được gửi lại. Vui lòng kiểm tra hòm thư của bạn!",{duration:5e3}),y(!0),p(60)):l.error("Gửi mã OTP thất bại. Vui lòng thử lại sau!",{duration:5e3})}catch(t){console.log(t),l.error("Có lỗi xảy ra, vui lòng thử lại sau!",{duration:5e3})}finally{f(!1)}};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-zinc-400",children:s.jsxs("div",{className:"p-8 bg-white rounded-xl shadow-md w-full max-w-lg",children:[s.jsx(X,{isLoading:P}),s.jsx("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-800",children:"Xác nhận tài khoản"}),s.jsxs("form",{ref:O,onSubmit:g,className:"space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"otp",className:"text-sm font-medium text-gray-700",children:"Nhập mã OTP 6 số"}),s.jsx("div",{className:"flex justify-between px-8 pt-2",onPaste:I,children:c.map((t,e)=>s.jsx("input",{type:"text",maxLength:"1",value:t,onChange:n=>R(n.target,e),onKeyDown:n=>D(n,e),ref:n=>o.current[e]=n,className:"w-12 h-12 text-center text-2xl border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},e))})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("button",{type:"submit",className:"flex-auto w-1/2 mt-0 btn btn--outline",children:"Xác nhận"}),s.jsx("button",{type:"button",disabled:h,onClick:k,className:"flex-auto w-1/2 ml-4 mt-0 btn btn--outline",children:h?`Gửi lại mã sau ${C}s`:"Gửi lại mã OTP"})]})]})]})})})}const z=()=>s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"sticky top-0 z-50"}),s.jsx(B,{title:"Xác nhận tài khoản"}),s.jsx($,{}),s.jsx(V,{})]});export{z as default};
